<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis AI Coach - Motion Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            text-align: center;
            position: relative;
        }
        
        .technique-selection {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .technique-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .technique-header h3 {
            color: #2d3748;
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .technique-header p {
            color: #718096;
            font-size: 14px;
        }
        
        .technique-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .technique-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }
        
        .technique-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
            border-color: #cbd5e0;
        }
        
        .technique-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.4);
        }
        
        .technique-card.selected .technique-icon {
            transform: scale(1.1);
        }
        
        .technique-icon {
            font-size: 24px;
            margin-bottom: 8px;
            transition: transform 0.3s ease;
        }
        
        .technique-name {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .technique-name-en {
            font-size: 11px;
            opacity: 0.8;
        }
        
        .technique-card.selected .technique-name-en {
            opacity: 0.9;
        }
        
        .selected-technique-info {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        
        .selected-technique-info.show {
            display: block;
            animation: fadeInUp 0.3s ease;
        }
        
        .selected-technique-info h4 {
            color: #2d3748;
            font-size: 16px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }
        
        .analysis-disabled {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .selection-required {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            color: #c53030;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            margin-bottom: 15px;
            display: none;
        }
        
        .selection-required.show {
            display: block;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .language-switch {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            background: rgba(103, 126, 234, 0.1);
            border-radius: 20px;
            padding: 3px;
            gap: 2px;
        }
        
        .lang-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: #667eea;
        }
        
        .lang-btn.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .lang-btn:hover:not(.active) {
            background: rgba(103, 126, 234, 0.1);
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #718096;
            font-size: 16px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .video-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .video-container {
            position: relative;
            background: #1a202c;
            border-radius: 12px;
            height: 400px;
            margin-bottom: 15px;
            overflow: hidden;
            max-width: 100%;
        }
        
        #videoElement {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }
        
        #uploadVideoElement {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }
        
        #uploadVideoElement {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 12px;
        }
        
        #canvasElement {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        #uploadCanvasElement {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .video-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #a0aec0;
            text-align: center;
            font-size: 16px;
            max-width: 90%;
            padding: 20px;
        }
        
        .video-placeholder small {
            font-size: 12px;
            display: block;
            margin-top: 8px;
        }
        
        .camera-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        .camera-switch-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 20px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            gap: 5px;
        }
        
        .camera-switch-btn.show {
            display: flex;
        }
        
        .camera-switch-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }
        
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
            background: #f7fafc;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: #edf2f7;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: #e6fffa;
        }
        
        #fileInput {
            display: none;
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .video-controls {
            display: none;
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .video-controls.show {
            display: block;
        }
        
        .progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            flex: 1;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .progress-fill {
            height: 100%;
            background: #667eea;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .time-display {
            font-size: 12px;
            color: #4a5568;
            min-width: 80px;
        }
        
        .playback-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: #cbd5e0;
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-danger {
            background: #e53e3e;
            color: white;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .analysis-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .analysis-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#48bb78 0deg 252deg, #e2e8f0 252deg 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            position: relative;
            transition: all 0.5s ease;
        }
        
        .score-inner {
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .score-number {
            font-size: 28px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .score-label {
            font-size: 12px;
            color: #718096;
        }
        
        .metrics {
            margin-bottom: 20px;
        }
        
        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric-item:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #4a5568;
            font-size: 14px;
        }
        
        .metric-value {
            color: #2d3748;
            font-weight: 600;
            font-size: 14px;
        }
        
        .metric-bar {
            width: 80px;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-left: 10px;
        }
        
        .metric-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .suggestions {
            background: #f7fafc;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .suggestions h3 {
            color: #2d3748;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .suggestion-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 14px;
            color: #4a5568;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.5s ease forwards;
        }
        
        .suggestion-item:nth-child(2) { animation-delay: 0.1s; }
        .suggestion-item:nth-child(3) { animation-delay: 0.2s; }
        .suggestion-item:nth-child(4) { animation-delay: 0.3s; }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .suggestion-icon {
            width: 16px;
            height: 16px;
            background: #667eea;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 10px;
            background: rgba(72, 187, 120, 0.1);
            color: #38a169;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            z-index: 10;
        }
        
        .analysis-progress {
            display: none;
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .analysis-progress.show {
            display: block;
        }
        
        .progress-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        .error-message {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            color: #c53030;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .mode-tabs {
            display: flex;
            background: #f7fafc;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 20px;
        }
        
        .mode-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
        }
        
        .mode-tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mode-tab:not(.active) {
            color: #718096;
        }
        
        .mode-content {
            display: none;
        }
        
        .mode-content.active {
            display: block;
        }
        
        .camera-indicator {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 500;
            display: none;
            z-index: 10;
        }
        
        .camera-indicator.show {
            display: block;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .controls {
                gap: 8px;
            }
            
            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .video-container {
                height: 250px;
                max-height: 50vh;
            }
            
            .mode-tabs {
                flex-direction: column;
            }
            
            .camera-switch-btn {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            .app-container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .header .subtitle {
                font-size: 14px;
            }
            
            .language-switch {
                top: 12px;
                right: 12px;
            }
            
            .analysis-panel {
                padding: 15px;
            }
            
            .video-section {
                padding: 15px;
            }
            
            .technique-selection {
                padding: 15px;
            }
            
            .technique-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .technique-card {
                padding: 12px;
            }
            
            .technique-icon {
                font-size: 20px;
            }
            
            .technique-name {
                font-size: 13px;
            }
            
            .technique-name-en {
                font-size: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .video-container {
                height: 200px;
                max-height: 40vh;
            }
            
            .score-circle {
                width: 100px;
                height: 100px;
            }
            
            .score-inner {
                width: 75px;
                height: 75px;
            }
            
            .score-number {
                font-size: 24px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 11px;
            }
            
            .metric-bar {
                width: 60px;
            }
            
            .video-placeholder {
                font-size: 14px;
                padding: 15px;
            }
            
            .video-placeholder small {
                font-size: 11px;
            }
            
            .language-switch {
                top: 10px;
                right: 10px;
                transform: scale(0.9);
            }
            
            .lang-btn {
                padding: 4px 8px;
                font-size: 10px;
            }
            
            .technique-selection {
                padding: 12px;
            }
            
            .technique-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .technique-card {
                padding: 10px;
            }
            
            .technique-icon {
                font-size: 18px;
            }
            
            .technique-name {
                font-size: 12px;
            }
            
            .technique-name-en {
                font-size: 9px;
            }
            
            .technique-header h3 {
                font-size: 16px;
            }
            
            .technique-header p {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="language-switch">
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="zh">ä¸­æ–‡</button>
            </div>
            <h1 data-text="title">ğŸ¾ Tennis AI Coach</h1>
            <p class="subtitle" data-text="subtitle">AI-powered tennis technique analysis and coaching - Support live camera and video file analysis</p>
        </div>
        
        <!-- Error Message -->
        <div class="error-message" id="errorMessage"></div>
        
        <!-- Technique Selection -->
        <div class="technique-selection">
            <div class="technique-header">
                <h3 data-text="selectTechnique">Select Tennis Technique</h3>
                <p data-text="selectTechniqueDesc">Choose the specific technique you want to analyze for more accurate results</p>
            </div>
            
            <div class="technique-grid">
                <div class="technique-card" data-technique="serve">
                    <div class="technique-icon">ğŸ¾</div>
                    <div class="technique-name" data-text="serve">Serve</div>
                    <div class="technique-name-en" data-text="serveEn">å‘çƒ</div>
                </div>
                
                <div class="technique-card" data-technique="forehand">
                    <div class="technique-icon">ğŸ¸</div>
                    <div class="technique-name" data-text="forehand">Forehand</div>
                    <div class="technique-name-en" data-text="forehandEn">æ­£æ‰‹å‡»çƒ</div>
                </div>
                
                <div class="technique-card" data-technique="backhand">
                    <div class="technique-icon">ğŸ¯</div>
                    <div class="technique-name" data-text="backhand">Backhand</div>
                    <div class="technique-name-en" data-text="backhandEn">åæ‰‹å‡»çƒ</div>
                </div>
                
                <div class="technique-card" data-technique="volley">
                    <div class="technique-icon">âš¡</div>
                    <div class="technique-name" data-text="volley">Volley</div>
                    <div class="technique-name-en" data-text="volleyEn">æˆªå‡»çƒ</div>
                </div>
                
                <div class="technique-card" data-technique="slice">
                    <div class="technique-icon">ğŸŒ€</div>
                    <div class="technique-name" data-text="slice">Slice</div>
                    <div class="technique-name-en" data-text="sliceEn">åˆ‡å‰Šçƒ</div>
                </div>
                
                <div class="technique-card" data-technique="overhead">
                    <div class="technique-icon">ğŸ’¥</div>
                    <div class="technique-name" data-text="overhead">Overhead Smash</div>
                    <div class="technique-name-en" data-text="overheadEn">é«˜å‹çƒ</div>
                </div>
            </div>
            
            <div class="selected-technique-info" id="selectedTechniqueInfo">
                <h4 id="selectedTechniqueName">
                    <span>ğŸ¾</span>
                    <span data-text="selectedTechniqueTitle">Analysis Focus</span>
                </h4>
                <p style="color: #4a5568; font-size: 14px; text-align: center; margin-top: 8px;" data-text="techniqueSelectedDesc">
                    Analysis metrics will update to focus on this specific technique
                </p>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Video Analysis Section -->
            <div class="video-section">
                <!-- Selection Required Warning -->
                <div class="selection-required" id="selectionRequired">
                    <span data-text="techniqueRequired">âš ï¸ Please select a tennis technique above before starting analysis</span>
                </div>
                
                <!-- Mode Tabs -->
                <div class="mode-tabs">
                    <div class="mode-tab active" data-mode="camera" data-text="liveCameraTab">ğŸ“¹ Live Camera</div>
                    <div class="mode-tab" data-mode="upload" data-text="uploadVideoTab">ğŸ“ Upload Video</div>
                </div>
                
                <!-- Camera Mode -->
                <div class="mode-content active" id="cameraMode">
                    <div class="video-container">
                        <div class="camera-controls">
                            <button class="camera-switch-btn" id="cameraSwitchBtn" data-text="switchCamera">
                                ğŸ”„ Switch Camera
                            </button>
                        </div>
                        <div class="status-indicator" id="statusIndicator" data-text="ready">Ready</div>
                        <div class="camera-indicator" id="cameraIndicator" data-text="frontCamera">Front Camera</div>
                        <video id="videoElement" autoplay muted playsinline style="display: none;"></video>
                        <canvas id="canvasElement"></canvas>
                        <div class="video-placeholder" id="placeholder">
                            <span data-text="cameraPlaceholder">ğŸ“¹<br>Click to start camera analysis<br></span>
                            <small data-text="cameraPlaceholderSmall">Real-time tennis motion recognition</small>
                        </div>
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-primary" id="startBtn" data-text="startAnalysis">
                            ğŸ¥ Start Analysis
                        </button>
                        <button class="btn btn-danger" id="stopBtn" style="display: none;" data-text="stopAnalysis">
                            â¹ï¸ Stop Analysis
                        </button>
                        <button class="btn btn-secondary" id="resetBtn" data-text="reset">
                            ğŸ”„ Reset
                        </button>
                    </div>
                </div>
                
                <!-- Upload Video Mode -->
                <div class="mode-content" id="uploadMode">
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">ğŸ“</div>
                        <p style="margin-bottom: 10px; color: #4a5568; font-weight: 500;" data-text="uploadText">Click or drag to upload video file</p>
                        <p style="font-size: 12px; color: #718096;" data-text="uploadFormat">Support MP4, MOV, AVI formats, max file size 50MB</p>
                        <input type="file" id="fileInput" accept="video/*">
                    </div>
                    
                    <div class="video-container" id="uploadVideoContainer" style="display: none;">
                        <div class="status-indicator" id="uploadStatusIndicator" data-text="videoLoaded">Video Loaded</div>
                        <video id="uploadVideoElement" controls></video>
                        <canvas id="uploadCanvasElement"></canvas>
                    </div>
                    
                    <div class="video-controls" id="videoControls">
                        <div class="progress-container">
                            <span class="time-display" id="currentTime">00:00</span>
                            <div class="progress-bar" id="progressBar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <span class="time-display" id="totalTime">00:00</span>
                        </div>
                        <div class="playback-controls">
                            <button class="btn btn-secondary btn-small" id="playPauseBtn" data-text="play">â–¶ï¸ Play</button>
                            <button class="btn btn-primary btn-small" id="analyzeVideoBtn" data-text="analyzeVideo">ğŸ” Analyze Video</button>
                            <button class="btn btn-secondary btn-small" id="clearVideoBtn" data-text="clear">ğŸ—‘ï¸ Clear</button>
                        </div>
                    </div>
                    
                    <div class="analysis-progress" id="analysisProgress">
                        <div class="progress-spinner"></div>
                        <p style="color: #2d3748; font-weight: 500; margin-bottom: 5px;" data-text="analyzingVideo">Analyzing video...</p>
                        <p style="color: #718096; font-size: 14px;" id="analysisProgressText" data-text="processingWait">Processing, please wait</p>
                    </div>
                </div>
                
                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p data-text="loadingAI">Loading AI model...</p>
                </div>
            </div>
            
            <!-- Analysis Results Panel -->
            <div class="analysis-panel">
                <div class="analysis-header">
                    <div class="score-circle" id="scoreCircle">
                        <div class="score-inner">
                            <div class="score-number" id="scoreNumber">--</div>
                            <div class="score-label" data-text="overallScore">Overall Score</div>
                        </div>
                    </div>
                    <h3 style="color: #2d3748; margin-bottom: 5px;" id="analysisTitle" data-text="selectAnalysisMode">Select Analysis Mode</h3>
                    <p style="color: #718096; font-size: 14px;" id="analysisDesc" data-text="chooseMode">Choose live camera or upload video for motion analysis</p>
                </div>
                
                <div class="metrics" id="metricsContainer">
                    <!-- Dynamic metrics will be inserted here -->
                </div>
                
                <div class="suggestions">
                    <h3 data-text="analysisSuggestions">ğŸ’¡ Analysis Suggestions</h3>
                    <div id="suggestionsList">
                        <div class="suggestion-item">
                            <div class="suggestion-icon"></div>
                            <span data-text="selectModeForSuggestions">Select analysis mode to see motion suggestions</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MediaPipe Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

    <script>
        // Language Configuration
        const languages = {
            en: {
                title: 'ğŸ¾ Tennis AI Coach',
                subtitle: 'AI-powered tennis technique analysis and coaching - Support live camera and video file analysis',
                
                // Technique Selection
                selectTechnique: 'Select Tennis Technique',
                selectTechniqueDesc: 'Choose the specific technique you want to analyze for more accurate results',
                serve: 'Serve',
                serveEn: 'å‘çƒ',
                forehand: 'Forehand',
                forehandEn: 'æ­£æ‰‹å‡»çƒ',
                backhand: 'Backhand',
                backhandEn: 'åæ‰‹å‡»çƒ',
                volley: 'Volley',
                volleyEn: 'æˆªå‡»çƒ',
                slice: 'Slice',
                sliceEn: 'åˆ‡å‰Šçƒ',
                overhead: 'Overhead Smash',
                overheadEn: 'é«˜å‹çƒ',
                selectedTechniqueTitle: 'Analysis Focus',
                techniqueRequired: 'âš ï¸ Please select a tennis technique above before starting analysis',
                techniqueSelectedDesc: 'Analysis metrics will update to focus on this specific technique',
                
                liveCameraTab: 'ğŸ“¹ Live Camera',
                uploadVideoTab: 'ğŸ“ Upload Video',
                switchCamera: 'ğŸ”„ Switch Camera',
                ready: 'Ready',
                frontCamera: 'Front Camera',
                rearCamera: 'Rear Camera',
                cameraPlaceholder: 'ğŸ“¹<br>Click to start camera analysis<br>',
                cameraPlaceholderSmall: 'Real-time tennis motion recognition',
                startAnalysis: 'ğŸ¥ Start Analysis',
                stopAnalysis: 'â¹ï¸ Stop Analysis',
                reset: 'ğŸ”„ Reset',
                uploadText: 'Click or drag to upload video file',
                uploadFormat: 'Support MP4, MOV, AVI formats, max file size 50MB',
                videoLoaded: 'Video Loaded',
                play: 'â–¶ï¸ Play',
                pause: 'â¸ï¸ Pause',
                analyzeVideo: 'ğŸ” Analyze Video',
                clear: 'ğŸ—‘ï¸ Clear',
                analyzingVideo: 'Analyzing video...',
                processingWait: 'Processing, please wait',
                overallScore: 'Overall Score',
                selectAnalysisMode: 'Select Analysis Mode',
                chooseMode: 'Choose live camera or upload video for motion analysis',
                
                // Technique-specific metrics
                shoulder_angle: 'Shoulder Rotation Angle',
                impact_position: 'Impact Position',
                racket_angle: 'Racket Face Angle',
                follow_through_height: 'Follow-through Height',
                balance: 'Balance',
                
                // Suggestions
                analysisSuggestions: 'ğŸ’¡ Analysis Suggestions',
                selectModeForSuggestions: 'Select analysis mode to see motion suggestions',
                loadingAI: 'Loading AI model...',
                
                // Status messages
                startingCamera: 'Starting camera...',
                analyzing: 'Analyzing...',
                stopped: 'Stopped',
                
                // Analysis modes
                liveCameraMode: 'Live Camera Mode',
                videoFileMode: 'Video File Mode',
                clickToStart: 'Click start to begin real-time motion analysis',
                uploadForAnalysis: 'Upload a video file for motion analysis',
                realTimeAnalysis: 'Real-time Motion Analysis',
                videoAnalysisComplete: 'Video Analysis Complete',
                
                // Suggestions
                keepStable: 'Keep your body center stable, maintain firm footing',
                makeFluid: 'Make your movements more fluid, avoid sudden stops',
                focusCoordination: 'Focus on coordinating all body parts together',
                improveStroke: 'Improve stroke technique, extend arms fully',
                greatTechnique: 'Great technique! Keep it up!',
                
                // Analysis descriptions
                excellentTechnique: 'Excellent technique, keep it up!',
                goodForm: 'Good form, continue refining details',
                basicCorrect: 'Basic technique correct, needs improvement',
                needsAdjustment: 'Technique needs adjustment, follow suggestions',
                studyTutorials: 'Recommend studying tutorial videos for basic techniques',
                
                // Error messages
                initFailed: 'Initialization failed: ',
                cameraAccess: 'Cannot access camera: ',
                switchFailed: 'Failed to switch camera: ',
                startFirst: 'Please start camera analysis first',
                selectVideo: 'Please select a valid video file',
                fileSizeLimit: 'File size cannot exceed 50MB',
                uploadFirst: 'Please upload a video file first',
                videoAnalysisFailed: 'Video analysis failed: ',
                noValidData: 'No valid motion data detected. Please ensure the video shows clear human movements',
                noValidMovements: 'No valid movements found in video. Please upload a video with clear human motion',
                loadFailed: 'Failed to load video: ',
                selectTechniqueFirst: 'Please select a tennis technique first'
            },
            zh: {
                title: 'ğŸ¾ ç½‘çƒæ™ºèƒ½é™ªç»ƒ',
                subtitle: 'AIé©±åŠ¨çš„ç½‘çƒæŠ€æœ¯åˆ†æä¸æŒ‡å¯¼ - æ”¯æŒå®æ—¶æ‘„åƒå¤´å’Œè§†é¢‘æ–‡ä»¶åˆ†æ',
                
                // Technique Selection
                selectTechnique: 'é€‰æ‹©ç½‘çƒæŠ€æœ¯åŠ¨ä½œ',
                selectTechniqueDesc: 'é€‰æ‹©æ‚¨è¦åˆ†æçš„å…·ä½“æŠ€æœ¯åŠ¨ä½œï¼Œä»¥è·å¾—æ›´å‡†ç¡®çš„åˆ†æç»“æœ',
                serve: 'å‘çƒ',
                serveEn: 'Serve',
                forehand: 'æ­£æ‰‹å‡»çƒ',
                forehandEn: 'Forehand',
                backhand: 'åæ‰‹å‡»çƒ',
                backhandEn: 'Backhand',
                volley: 'æˆªå‡»çƒ',
                volleyEn: 'Volley',
                slice: 'åˆ‡å‰Šçƒ',
                sliceEn: 'Slice',
                overhead: 'é«˜å‹çƒ',
                overheadEn: 'Overhead Smash',
                selectedTechniqueTitle: 'åˆ†æé‡ç‚¹',
                techniqueRequired: 'âš ï¸ è¯·å…ˆåœ¨ä¸Šæ–¹é€‰æ‹©ä¸€ä¸ªç½‘çƒæŠ€æœ¯åŠ¨ä½œå†å¼€å§‹åˆ†æ',
                techniqueSelectedDesc: 'åˆ†ææŒ‡æ ‡å°†æ›´æ–°ä¸ºä¸“æ³¨äºæ­¤ç‰¹å®šæŠ€æœ¯åŠ¨ä½œ',
                
                liveCameraTab: 'ğŸ“¹ å®æ—¶æ‘„åƒå¤´',
                uploadVideoTab: 'ğŸ“ ä¸Šä¼ è§†é¢‘',
                switchCamera: 'ğŸ”„ åˆ‡æ¢æ‘„åƒå¤´',
                ready: 'å‡†å¤‡å°±ç»ª',
                frontCamera: 'å‰ç½®æ‘„åƒå¤´',
                rearCamera: 'åç½®æ‘„åƒå¤´',
                cameraPlaceholder: 'ğŸ“¹<br>ç‚¹å‡»å¼€å§‹æ‘„åƒå¤´åˆ†æ<br>',
                cameraPlaceholderSmall: 'å®æ—¶ç½‘çƒåŠ¨ä½œè¯†åˆ«',
                startAnalysis: 'ğŸ¥ å¼€å§‹åˆ†æ',
                stopAnalysis: 'â¹ï¸ åœæ­¢åˆ†æ',
                reset: 'ğŸ”„ é‡ç½®',
                uploadText: 'ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ è§†é¢‘æ–‡ä»¶',
                uploadFormat: 'æ”¯æŒ MP4, MOV, AVI æ ¼å¼ï¼Œå»ºè®®æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 50MB',
                videoLoaded: 'è§†é¢‘å·²åŠ è½½',
                play: 'â–¶ï¸ æ’­æ”¾',
                pause: 'â¸ï¸ æš‚åœ',
                analyzeVideo: 'ğŸ” åˆ†æè§†é¢‘',
                clear: 'ğŸ—‘ï¸ æ¸…é™¤',
                analyzingVideo: 'æ­£åœ¨åˆ†æè§†é¢‘...',
                processingWait: 'å¤„ç†ä¸­ï¼Œè¯·ç¨å€™',
                overallScore: 'ç»¼åˆè¯„åˆ†',
                selectAnalysisMode: 'é€‰æ‹©åˆ†ææ¨¡å¼',
                chooseMode: 'å®æ—¶æ‘„åƒå¤´æˆ–ä¸Šä¼ è§†é¢‘è¿›è¡ŒåŠ¨ä½œåˆ†æ',
                
                // Technique-specific metrics
                shoulder_angle: 'è‚©éƒ¨æ—‹è½¬è§’åº¦',
                impact_position: 'å‡»çƒç‚¹ä½ç½®',
                racket_angle: 'æ‹é¢è§’åº¦',
                follow_through_height: 'éšæŒ¥é«˜åº¦',
                balance: 'å¹³è¡¡å§¿åŠ¿',
                
                analysisSuggestions: 'ğŸ’¡ åˆ†æå»ºè®®',
                selectModeForSuggestions: 'é€‰æ‹©åˆ†ææ¨¡å¼åå°†æ˜¾ç¤ºåŠ¨ä½œå»ºè®®',
                loadingAI: 'æ­£åœ¨åŠ è½½AIæ¨¡å‹...',
                
                // Status messages
                startingCamera: 'å¯åŠ¨æ‘„åƒå¤´...',
                analyzing: 'åˆ†æä¸­...',
                stopped: 'å·²åœæ­¢',
                
                // Analysis modes
                liveCameraMode: 'å®æ—¶æ‘„åƒå¤´æ¨¡å¼',
                videoFileMode: 'è§†é¢‘æ–‡ä»¶æ¨¡å¼',
                clickToStart: 'ç‚¹å‡»å¼€å§‹è¿›è¡Œå®æ—¶åŠ¨ä½œåˆ†æ',
                uploadForAnalysis: 'ä¸Šä¼ è§†é¢‘æ–‡ä»¶è¿›è¡ŒåŠ¨ä½œåˆ†æ',
                realTimeAnalysis: 'å®æ—¶åŠ¨ä½œåˆ†æ',
                videoAnalysisComplete: 'è§†é¢‘åˆ†æå®Œæˆ',
                
                // Suggestions
                keepStable: 'ä¿æŒèº«ä½“é‡å¿ƒç¨³å®šï¼ŒåŒè„šç«™ç¨³',
                makeFluid: 'åŠ¨ä½œè¦æ›´åŠ æµç•…ï¼Œé¿å…çªç„¶åœé¡¿',
                focusCoordination: 'æ³¨æ„èº«ä½“å„éƒ¨åˆ†çš„åè°ƒé…åˆ',
                improveStroke: 'å®Œå–„å‡»çƒå§¿åŠ¿ï¼Œæ‰‹è‡‚å……åˆ†ä¼¸å±•',
                greatTechnique: 'åŠ¨ä½œå¾ˆæ£’ï¼Œç»§ç»­ä¿æŒï¼',
                
                // Analysis descriptions
                excellentTechnique: 'åŠ¨ä½œéå¸¸æ ‡å‡†ï¼Œä¿æŒä¸‹å»ï¼',
                goodForm: 'åŠ¨ä½œè‰¯å¥½ï¼Œç»§ç»­ä¼˜åŒ–ç»†èŠ‚',
                basicCorrect: 'åŠ¨ä½œåŸºæœ¬æ­£ç¡®ï¼Œéœ€è¦æ”¹è¿›',
                needsAdjustment: 'åŠ¨ä½œéœ€è¦è°ƒæ•´ï¼Œæ³¨æ„å»ºè®®',
                studyTutorials: 'å»ºè®®å‚è€ƒæ•™å­¦è§†é¢‘å­¦ä¹ åŸºç¡€åŠ¨ä½œ',
                
                // Error messages
                initFailed: 'åˆå§‹åŒ–å¤±è´¥ï¼š',
                cameraAccess: 'æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼š',
                switchFailed: 'æ‘„åƒå¤´åˆ‡æ¢å¤±è´¥ï¼š',
                startFirst: 'è¯·å…ˆå¼€å§‹æ‘„åƒå¤´åˆ†æ',
                selectVideo: 'è¯·é€‰æ‹©æœ‰æ•ˆçš„è§†é¢‘æ–‡ä»¶',
                fileSizeLimit: 'æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡50MB',
                uploadFirst: 'è¯·å…ˆä¸Šä¼ è§†é¢‘æ–‡ä»¶',
                videoAnalysisFailed: 'è§†é¢‘åˆ†æå¤±è´¥ï¼š',
                noValidData: 'æœªæ£€æµ‹åˆ°æœ‰æ•ˆçš„åŠ¨ä½œæ•°æ®ï¼Œè¯·ç¡®ä¿è§†é¢‘ä¸­æœ‰æ¸…æ™°çš„äººä½“åŠ¨ä½œ',
                noValidMovements: 'è§†é¢‘åˆ†ææœªå‘ç°æœ‰æ•ˆåŠ¨ä½œï¼Œè¯·ä¸Šä¼ åŒ…å«æ¸…æ™°äººä½“åŠ¨ä½œçš„è§†é¢‘',
                loadFailed: 'è§†é¢‘åŠ è½½å¤±è´¥ï¼š',
                selectTechniqueFirst: 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç½‘çƒæŠ€æœ¯åŠ¨ä½œ'
            }
        };

        // Technique Configuration
        const techniqueConfigs = {
            forehand: {
                metrics: [
                    { key: "shoulder_angle", name: "shoulder_angle", ideal: 60, range: [55, 75] },
                    { key: "impact_position", name: "impact_position", ideal: 0.25, range: [0.2, 0.3] },
                    { key: "racket_angle", name: "racket_angle", ideal: 90, range: [85, 95] },
                    { key: "follow_through_height", name: "follow_through_height", ideal: "high", range: ["mid", "high"] },
                    { key: "balance", name: "balance", ideal: true, range: [true] }
                ]
            },
            serve: {
                metrics: [
                    { key: "ball_toss", name: "Ball Toss Height", ideal: 1.8, range: [1.7, 2.0] },
                    { key: "shoulder_turn", name: "Shoulder Turn", ideal: 90, range: [85, 95] },
                    { key: "knee_bend", name: "Knee Bend", ideal: 45, range: [40, 50] },
                    { key: "follow_through", name: "Follow-through", ideal: true, range: [true] }
                ]
            },
            backhand: {
                metrics: [
                    { key: "grip_position", name: "Grip Position", ideal: "eastern", range: ["eastern", "continental"] },
                    { key: "backswing", name: "Backswing Height", ideal: 0.8, range: [0.7, 0.9] },
                    { key: "body_rotation", name: "Body Rotation", ideal: 45, range: [40, 50] },
                    { key: "finish_position", name: "Finish Position", ideal: "over_shoulder", range: ["shoulder", "over_shoulder"] }
                ]
            },
            volley: {
                metrics: [
                    { key: "racket_position", name: "Racket Position", ideal: "high", range: ["mid", "high"] },
                    { key: "step_forward", name: "Step Forward", ideal: true, range: [true] },
                    { key: "wrist_firm", name: "Wrist Firmness", ideal: 8, range: [7, 9] },
                    { key: "contact_point", name: "Contact Point", ideal: 0.9, range: [0.8, 1.0] }
                ]
            },
            slice: {
                metrics: [
                    { key: "racket_angle", name: "Racket Angle", ideal: 10, range: [5, 15] },
                    { key: "swing_path", name: "Swing Path", ideal: "high-to-low", range: ["high-to-low", "level"] },
                    { key: "follow_through", name: "Follow-through", ideal: "low", range: ["mid", "low"] },
                    { key: "ball_spin", name: "Ball Spin", ideal: "backspin", range: ["backspin", "sidespin"] }
                ]
            },
            overhead: {
                metrics: [
                    { key: "positioning", name: "Positioning", ideal: "under_ball", range: ["under_ball", "behind_ball"] },
                    { key: "racket_prep", name: "Racket Preparation", ideal: "early", range: ["early", "on_time"] },
                    { key: "contact_height", name: "Contact Height", ideal: 2.2, range: [2.0, 2.4] },
                    { key: "finish", name: "Finish", ideal: "across_body", range: ["across_body", "down"] }
                ]
            }
        };

        // Language Manager
        class LanguageManager {
            constructor() {
                this.currentLang = 'en';
                this.loadSavedLanguage();
                this.setupLanguageButtons();
            }

            loadSavedLanguage() {
                const saved = localStorage.getItem('tennis-ai-language');
                if (saved && languages[saved]) {
                    this.currentLang = saved;
                }
                this.updateInterface();
            }

            setupLanguageButtons() {
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const lang = btn.dataset.lang;
                        this.switchLanguage(lang);
                    });
                });
            }

            switchLanguage(lang) {
                if (!languages[lang]) return;
                
                this.currentLang = lang;
                localStorage.setItem('tennis-ai-language', lang);
                
                // Update button states
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === lang);
                });
                
                this.updateInterface();
                
                // Update analysis metrics if a technique is selected
                if (window.tennisAnalyzer && window.tennisAnalyzer.selectedTechnique) {
                    window.tennisAnalyzer.updateAnalysisMetrics(window.tennisAnalyzer.selectedTechnique);
                    window.tennisAnalyzer.updateTechniqueInfo(window.tennisAnalyzer.selectedTechnique);
                }
            }

            updateInterface() {
                const texts = languages[this.currentLang];
                
                // Update all elements with data-text attribute
                document.querySelectorAll('[data-text]').forEach(element => {
                    const key = element.dataset.text;
                    if (texts[key]) {
                        if (element.tagName === 'INPUT') {
                            element.placeholder = texts[key];
                        } else {
                            element.innerHTML = texts[key];
                        }
                    }
                });

                // Update button active state on load
                document.querySelectorAll('.lang-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.lang === this.currentLang);
                });
                
                // Update technique metrics if tennis analyzer is available
                if (window.tennisAnalyzer && window.tennisAnalyzer.selectedTechnique) {
                    window.tennisAnalyzer.updateAnalysisMetrics(window.tennisAnalyzer.selectedTechnique);
                    window.tennisAnalyzer.updateTechniqueInfo(window.tennisAnalyzer.selectedTechnique);
                }
            }

            getText(key) {
                return languages[this.currentLang][key] || key;
            }
        }

        // Initialize language manager
        const langManager = new LanguageManager();
        class TennisAnalyzer {
            constructor() {
                this.pose = null;
                this.camera = null;
                this.videoElement = document.getElementById('videoElement');
                this.uploadVideoElement = document.getElementById('uploadVideoElement');
                this.canvasElement = document.getElementById('canvasElement');
                this.uploadCanvasElement = document.getElementById('uploadCanvasElement');
                this.canvasCtx = this.canvasElement.getContext('2d');
                this.uploadCanvasCtx = this.uploadCanvasElement.getContext('2d');
                this.isAnalyzing = false;
                this.isUploadMode = false;
                this.frameCount = 0;
                this.poseHistory = [];
                this.currentFacingMode = 'user'; // 'user' for front camera, 'environment' for rear camera
                this.selectedTechnique = null; // Selected tennis technique
                this.currentMetrics = {};
                this.techniqueConfigs = techniqueConfigs;
                
                // Ensure langManager is available
                this.langManager = window.langManager;
                
                this.init();
            }
            
            // Helper method for getting translated text
            getText(key) {
                if (this.langManager && this.langManager.getText) {
                    return this.langManager.getText(key);
                }
                return key;
            }
            
            selectTechnique(technique) {
                // Remove previous selection
                document.querySelectorAll('.technique-card').forEach(card => {
                    card.classList.remove('selected');
                });
                
                // Add selection to clicked card
                document.querySelector(`[data-technique="${technique}"]`).classList.add('selected');
                
                // Update selected technique
                this.selectedTechnique = technique;
                
                // Show technique info
                this.updateTechniqueInfo(technique);
                
                // Enable analysis controls
                this.enableAnalysisControls();
                
                // Hide selection required warning
                document.getElementById('selectionRequired').classList.remove('show');
                
                // Force update analysis metrics
                this.updateAnalysisMetrics(technique);
            }
            
            updateTechniqueInfo(technique) {
                const infoPanel = document.getElementById('selectedTechniqueInfo');
                const nameElement = document.getElementById('selectedTechniqueName');
                
                // Update technique name and icon
                const icons = {
                    serve: 'ğŸ¾',
                    forehand: 'ğŸ¸',
                    backhand: 'ğŸ¯',
                    volley: 'âš¡',
                    slice: 'ğŸŒ€',
                    overhead: 'ğŸ’¥'
                };
                
                nameElement.innerHTML = `
                    <span>${icons[technique]}</span>
                    <span>${this.getText('selectedTechniqueTitle')}: ${this.getText(technique)}</span>
                `;
                
                // Show the info panel
                infoPanel.classList.add('show');
            }
            
            updateAnalysisMetrics(technique) {
                const metricsContainer = document.getElementById('metricsContainer');
                metricsContainer.innerHTML = '';
                
                if (!this.techniqueConfigs[technique]) return;
                
                const metrics = this.techniqueConfigs[technique].metrics;
                const metricItems = [];
                
                metrics.forEach(metric => {
                    const item = document.createElement('div');
                    item.className = 'metric-item';
                    item.innerHTML = `
                        <span class="metric-label">${this.getText(metric.name)}</span>
                        <div style="display: flex; align-items: center;">
                            <span class="metric-value">--</span>
                            <div class="metric-bar">
                                <div class="metric-fill"></div>
                            </div>
                        </div>
                    `;
                    metricItems.push(item);
                });
                
                metricItems.forEach(item => metricsContainer.appendChild(item));
            }
            
            enableAnalysisControls() {
                const videoSection = document.querySelector('.video-section');
                videoSection.classList.remove('analysis-disabled');
            }
            
            disableAnalysisControls() {
                const videoSection = document.querySelector('.video-section');
                videoSection.classList.add('analysis-disabled');
            }
            
            validateTechniqueSelection() {
                if (!this.selectedTechnique) {
                    document.getElementById('selectionRequired').classList.add('show');
                    setTimeout(() => {
                        document.getElementById('selectionRequired').classList.remove('show');
                    }, 3000);
                    return false;
                }
                return true;
            }
            
            async init() {
                try {
                    this.showLoading(true);
                    await this.initMediaPipe();
                    this.setupEventListeners();
                    this.showLoading(false);
                } catch (error) {
                    this.showError(this.getText('initFailed') + error.message);
                    this.showLoading(false);
                }
            }
            
            async initMediaPipe() {
                this.pose = new Pose({
                    locateFile: (file) => {
                        return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                    }
                });
                
                this.pose.setOptions({
                    modelComplexity: 1,
                    smoothLandmarks: true,
                    enableSegmentation: false,
                    smoothSegmentation: false,
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });
                
                this.pose.onResults(this.onResults.bind(this));
            }
            
            setupEventListeners() {
                // Mode switching
                document.querySelectorAll('.mode-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode));
                });
                
                // Technique selection
                document.querySelectorAll('.technique-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        const technique = card.dataset.technique;
                        this.selectTechnique(technique);
                    });
                });
                
                // Camera mode controls
                document.getElementById('startBtn').addEventListener('click', () => this.startCameraAnalysis());
                document.getElementById('stopBtn').addEventListener('click', () => this.stopAnalysis());
                document.getElementById('resetBtn').addEventListener('click', () => this.reset());
                document.getElementById('cameraSwitchBtn').addEventListener('click', () => this.switchCamera());
                
                // File upload
                const fileInput = document.getElementById('fileInput');
                const uploadArea = document.getElementById('uploadArea');
                
                uploadArea.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => this.handleFileUpload(e.target.files[0]));
                
                // Drag and drop upload
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const file = e.dataTransfer.files[0];
                    if (file && file.type.startsWith('video/')) {
                        this.handleFileUpload(file);
                    }
                });
                
                // Video controls
                document.getElementById('playPauseBtn').addEventListener('click', () => this.togglePlayPause());
                document.getElementById('analyzeVideoBtn').addEventListener('click', () => this.analyzeUploadedVideo());
                document.getElementById('clearVideoBtn').addEventListener('click', () => this.clearVideo());
                
                // Progress bar control
                document.getElementById('progressBar').addEventListener('click', (e) => this.seekVideo(e));
            }
            
            async switchCamera() {
                if (!this.isAnalyzing) {
                    this.showError(langManager.getText('startFirst'));
                    return;
                }
                
                try {
                    // Stop current camera
                    if (this.camera) {
                        this.camera.stop();
                    }
                    
                    if (this.videoElement.srcObject) {
                        this.videoElement.srcObject.getTracks().forEach(track => track.stop());
                    }
                    
                    // Switch facing mode
                    this.currentFacingMode = this.currentFacingMode === 'user' ? 'environment' : 'user';
                    
                    // Update camera indicator
                    this.updateCameraIndicator();
                    
                    // Restart camera with new facing mode
                    await this.startCameraStream();
                    
                } catch (error) {
                    this.showError(langManager.getText('switchFailed') + error.message);
                    // Revert facing mode if switch failed
                    this.currentFacingMode = this.currentFacingMode === 'user' ? 'environment' : 'user';
                    this.updateCameraIndicator();
                }
            }
            
            updateCameraIndicator() {
                const indicator = document.getElementById('cameraIndicator');
                indicator.textContent = this.currentFacingMode === 'user' ? 
                    langManager.getText('frontCamera') : langManager.getText('rearCamera');
            }
            
            switchMode(mode) {
                document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.mode-content').forEach(content => content.classList.remove('active'));
                
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
                document.getElementById(`${mode}Mode`).classList.add('active');
                
                this.isUploadMode = mode === 'upload';
                this.reset();
                
                if (mode === 'camera') {
                    this.updateAnalysisPanel('--', this.getText('liveCameraMode'), this.getText('clickToStart'));
                } else {
                    this.updateAnalysisPanel('--', this.getText('videoFileMode'), this.getText('uploadForAnalysis'));
                }
                
                // Ensure controls are disabled until technique is selected
                if (!this.selectedTechnique) {
                    this.disableAnalysisControls();
                }
            }
            
            async handleFileUpload(file) {
                if (!file || !file.type.startsWith('video/')) {
                    this.showError(langManager.getText('selectVideo'));
                    return;
                }
                
                if (file.size > 50 * 1024 * 1024) { // 50MB limit
                    this.showError(langManager.getText('fileSizeLimit'));
                    return;
                }
                
                try {
                    const url = URL.createObjectURL(file);
                    this.uploadVideoElement.src = url;
                    
                    this.uploadVideoElement.onloadedmetadata = () => {
                        document.getElementById('uploadArea').style.display = 'none';
                        document.getElementById('uploadVideoContainer').style.display = 'block';
                        document.getElementById('videoControls').classList.add('show');
                        
                        // Set canvas dimensions
                        this.uploadCanvasElement.width = this.uploadVideoElement.videoWidth;
                        this.uploadCanvasElement.height = this.uploadVideoElement.videoHeight;
                        
                        this.updateTimeDisplay();
                        this.updateAnalysisPanel('--', langManager.getText('videoLoaded'), 
                            langManager.getText('uploadForAnalysis').replace('Upload a video file for motion analysis', 'Click analyze button to process the video'));
                    };
                    
                    // Video time update
                    this.uploadVideoElement.addEventListener('timeupdate', () => {
                        this.updateTimeDisplay();
                        this.updateProgressBar();
                    });
                    
                } catch (error) {
                    this.showError(langManager.getText('loadFailed') + error.message);
                }
            }
            
            togglePlayPause() {
                const video = this.uploadVideoElement;
                const btn = document.getElementById('playPauseBtn');
                
                if (video.paused) {
                    video.play();
                    btn.textContent = langManager.getText('pause');
                } else {
                    video.pause();
                    btn.textContent = langManager.getText('play');
                }
            }
            
            updateTimeDisplay() {
                const video = this.uploadVideoElement;
                document.getElementById('currentTime').textContent = this.formatTime(video.currentTime);
                document.getElementById('totalTime').textContent = this.formatTime(video.duration);
            }
            
            updateProgressBar() {
                const video = this.uploadVideoElement;
                const progress = (video.currentTime / video.duration) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
            }
            
            seekVideo(e) {
                const progressBar = document.getElementById('progressBar');
                const rect = progressBar.getBoundingClientRect();
                const percentage = (e.clientX - rect.left) / rect.width;
                this.uploadVideoElement.currentTime = percentage * this.uploadVideoElement.duration;
            }
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            clearVideo() {
                this.uploadVideoElement.src = '';
                document.getElementById('uploadArea').style.display = 'block';
                document.getElementById('uploadVideoContainer').style.display = 'none';
                document.getElementById('videoControls').classList.remove('show');
                document.getElementById('analysisProgress').classList.remove('show');
                document.getElementById('fileInput').value = '';
                
                this.updateAnalysisPanel('--', langManager.getText('videoFileMode'), langManager.getText('uploadForAnalysis'));
                this.resetMetrics();
            }
            
            async analyzeUploadedVideo() {
                if (!this.uploadVideoElement.src) {
                    this.showError(langManager.getText('uploadFirst'));
                    return;
                }
                
                if (!this.selectedTechnique) {
                    this.showError(langManager.getText('selectTechniqueFirst'));
                    return;
                }
                
                this.isAnalyzing = true;
                document.getElementById('analysisProgress').classList.add('show');
                document.getElementById('analyzeVideoBtn').disabled = true;
                
                try {
                    // Simulate analysis progress
                    this.simulateAnalysisProgress();
                    
                    // After a delay, show results
                    setTimeout(() => {
                        this.isAnalyzing = false;
                        document.getElementById('analysisProgress').classList.remove('show');
                        document.getElementById('analyzeVideoBtn').disabled = false;
                        
                        // Generate simulated results for the selected technique
                        this.generateSimulatedResults();
                        
                        this.updateAnalysisPanel(
                            84,
                            langManager.getText('videoAnalysisComplete'),
                            `${langManager.currentLang === 'zh' ? 'è§†é¢‘åˆ†æå®Œæˆ' : 'Video analysis completed'}`
                        );
                        
                        this.updateMetrics();
                        this.updateSuggestions(this.generateSuggestions());
                    }, 3000);
                } catch (error) {
                    this.showError(langManager.getText('videoAnalysisFailed') + error.message);
                    this.isAnalyzing = false;
                    document.getElementById('analysisProgress').classList.remove('show');
                    document.getElementById('analyzeVideoBtn').disabled = false;
                }
            }
            
            simulateAnalysisProgress() {
                let progress = 0;
                const progressText = document.getElementById('analysisProgressText');
                const interval = setInterval(() => {
                    progress += 10;
                    progressText.textContent = `${langManager.getText('processingWait')} (${progress}%)`;
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                    }
                }, 300);
            }
            
            generateSimulatedResults() {
                if (!this.selectedTechnique || !this.techniqueConfigs[this.selectedTechnique]) return;
                
                const metrics = this.techniqueConfigs[this.selectedTechnique].metrics;
                this.currentMetrics = {};
                
                metrics.forEach(metric => {
                    // Generate simulated value based on ideal and range
                    let value;
                    
                    if (typeof metric.ideal === 'number') {
                        // For numeric metrics, generate a value near the ideal
                        const min = metric.range[0];
                        const max = metric.range[metric.range.length - 1];
                        const range = max - min;
                        const deviation = range * 0.15; // 15% deviation
                        
                        // Generate value within ideal Â± deviation
                        value = metric.ideal + (Math.random() * deviation * 2 - deviation);
                        value = Math.max(min, Math.min(max, value));
                        
                        // Calculate score based on proximity to ideal
                        const diff = Math.abs(value - metric.ideal);
                        const maxDiff = Math.max(metric.ideal - min, max - metric.ideal);
                        const score = Math.round(100 - (diff / maxDiff) * 40); // Max 40 points deduction
                        
                        this.currentMetrics[metric.key] = {
                            value: value.toFixed(2),
                            score: Math.max(60, Math.min(100, score))
                        };
                    } else if (typeof metric.ideal === 'boolean') {
                        // For boolean metrics, mostly true with 20% chance of false
                        value = Math.random() > 0.2;
                        this.currentMetrics[metric.key] = {
                            value: value ? 'Yes' : 'No',
                            score: value ? 100 : 60
                        };
                    } else {
                        // For string/enum metrics, mostly ideal with chance of other values
                        if (Math.random() > 0.3) {
                            value = metric.ideal;
                            this.currentMetrics[metric.key] = {
                                value: value,
                                score: 100
                            };
                        } else {
                            // Select a random value from the range
                            const index = Math.floor(Math.random() * metric.range.length);
                            value = metric.range[index];
                            this.currentMetrics[metric.key] = {
                                value: value,
                                score: value === metric.ideal ? 100 : 70
                            };
                        }
                    }
                });
            }
            
            calculateScore() {
                if (!this.currentMetrics || Object.keys(this.currentMetrics).length === 0) return 0;
                
                let totalScore = 0;
                let count = 0;
                
                for (const key in this.currentMetrics) {
                    if (this.currentMetrics[key].score) {
                        totalScore += this.currentMetrics[key].score;
                        count++;
                    }
                }
                
                return count > 0 ? Math.round(totalScore / count) : 0;
            }
            
            async startCameraAnalysis() {
                if (this.isUploadMode) return;
                
                if (!this.selectedTechnique) {
                    this.showError(langManager.getText('selectTechniqueFirst'));
                    return;
                }
                
                try {
                    this.updateStatus('startingCamera');
                    await this.startCameraStream();
                    
                    this.isAnalyzing = true;
                    this.updateStatus('analyzing');
                    this.updateButtons(false);
                    document.getElementById('cameraSwitchBtn').classList.add('show');
                    document.getElementById('cameraIndicator').classList.add('show');
                    
                    this.startAnalysisLoop();
                    
                } catch (error) {
                    this.showError(langManager.getText('cameraAccess') + error.message);
                }
            }
            
            async startCameraStream() {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        width: 640, 
                        height: 480,
                        facingMode: this.currentFacingMode
                    }
                });
                
                this.videoElement.srcObject = stream;
                this.videoElement.style.display = 'block';
                document.getElementById('placeholder').style.display = 'none';
                
                this.camera = new Camera(this.videoElement, {
                    onFrame: async () => {
                        if (this.isAnalyzing && !this.isUploadMode) {
                            await this.pose.send({image: this.videoElement});
                        }
                    },
                    width: 640,
                    height: 480
                });
                
                await this.camera.start();
                this.updateCameraIndicator();
            }
            
            stopAnalysis() {
                this.isAnalyzing = false;
                this.updateStatus('stopped');
                this.updateButtons(true);
                document.getElementById('cameraSwitchBtn').classList.remove('show');
                document.getElementById('cameraIndicator').classList.remove('show');
                
                if (this.camera) {
                    this.camera.stop();
                }
                
                if (this.videoElement.srcObject) {
                    this.videoElement.srcObject.getTracks().forEach(track => track.stop());
                }
            }
            
            reset() {
                this.stopAnalysis();
                this.frameCount = 0;
                this.poseHistory = [];
                this.currentFacingMode = 'user'; // Reset to front camera
                this.currentMetrics = {};
                
                if (!this.isUploadMode) {
                    this.videoElement.style.display = 'none';
                    document.getElementById('placeholder').style.display = 'block';
                    this.canvasCtx.clearRect(0, 0, this.canvasElement.width, this.canvasElement.height);
                    this.updateAnalysisPanel('--', langManager.getText('liveCameraMode'), langManager.getText('clickToStart'));
                } else {
                    this.clearVideo();
                }
                
                this.resetMetrics();
                this.updateSuggestions([{text: langManager.getText('selectModeForSuggestions')}]);
                this.updateStatus('ready');
                this.updateCameraIndicator();
            }
            
            onResults(results) {
                if (!this.isAnalyzing) return;
                
                const canvas = this.isUploadMode ? this.uploadCanvasElement : this.canvasElement;
                const ctx = this.isUploadMode ? this.uploadCanvasCtx : this.canvasCtx;
                const video = this.isUploadMode ? this.uploadVideoElement : this.videoElement;
                
                canvas.width = video.videoWidth || video.width || 640;
                canvas.height = video.videoHeight || video.height || 480;
                
                ctx.save();
                if (!this.isUploadMode) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
                
                if (results.poseLandmarks) {
                    this.drawPose(results.poseLandmarks, ctx, canvas);
                    
                    if (!this.isUploadMode) {
                        // Real-time mode: simulate analysis
                        this.generateSimulatedResults();
                        
                        const overallScore = this.calculateScore();
                        this.updateAnalysisPanel(
                            overallScore,
                            langManager.getText('realTimeAnalysis'),
                            this.getAnalysisDescription(overallScore)
                        );
                        
                        this.updateMetrics();
                        this.updateSuggestions(this.generateSuggestions());
                    }
                }
                
                ctx.restore();
                this.frameCount++;
            }
            
            drawPose(landmarks, ctx, canvas) {
                // Draw connections
                this.drawConnections(landmarks, [
                    [11, 12], [11, 13], [13, 15], [12, 14], [14, 16], // Arms
                    [11, 23], [12, 24], [23, 24], // Torso
                    [23, 25], [25, 27], [24, 26], [26, 28] // Legs
                ], '#00ff00', 2, ctx, canvas);
                
                // Draw landmarks
                this.drawLandmarks(landmarks, '#ff0000', 4, ctx, canvas);
            }
            
            drawConnections(landmarks, connections, color, width, ctx, canvas) {
                ctx.strokeStyle = color;
                ctx.lineWidth = width;
                
                connections.forEach(([start, end]) => {
                    const startPoint = landmarks[start];
                    const endPoint = landmarks[end];
                    
                    if (startPoint && endPoint) {
                        ctx.beginPath();
                        ctx.moveTo(
                            startPoint.x * canvas.width,
                            startPoint.y * canvas.height
                        );
                        ctx.lineTo(
                            endPoint.x * canvas.width,
                            endPoint.y * canvas.height
                        );
                        ctx.stroke();
                    }
                });
            }
            
            drawLandmarks(landmarks, color, radius, ctx, canvas) {
                ctx.fillStyle = color;
                
                landmarks.forEach(landmark => {
                    ctx.beginPath();
                    ctx.arc(
                        landmark.x * canvas.width,
                        landmark.y * canvas.height,
                        radius,
                        0,
                        2 * Math.PI
                    );
                    ctx.fill();
                });
            }
            
            generateSuggestions() {
                const suggestions = [];
                
                if (!this.selectedTechnique || !this.currentMetrics) {
                    suggestions.push({text: this.getText('selectModeForSuggestions')});
                    return suggestions;
                }
                
                // Technique-specific suggestions
                if (this.selectedTechnique === 'forehand') {
                    if (this.currentMetrics.shoulder_angle && this.currentMetrics.shoulder_angle.score < 80) {
                        suggestions.push({text: langManager.currentLang === 'zh' ? 
                            "å¢åŠ è‚©éƒ¨æ—‹è½¬è§’åº¦ä»¥è·å¾—æ›´å¥½çš„å‘åŠ›" : 
                            "Increase shoulder rotation for better power generation"});
                    }
                    
                    if (this.currentMetrics.impact_position && this.currentMetrics.impact_position.score < 75) {
                        suggestions.push({text: langManager.currentLang === 'zh' ? 
                            "å°è¯•åœ¨èº«ä½“å‰æ–¹æ›´æ—©å‡»çƒ" : 
                            "Try to make contact earlier in front of your body"});
                    }
                    
                    if (this.currentMetrics.racket_angle && this.currentMetrics.racket_angle.score < 70) {
                        suggestions.push({text: langManager.currentLang === 'zh' ? 
                            "è°ƒæ•´æ‹é¢è§’åº¦ä»¥æ§åˆ¶çƒçš„è½¨è¿¹" : 
                            "Adjust racket face angle to control ball trajectory"});
                    }
                    
                    if (this.currentMetrics.follow_through_height && this.currentMetrics.follow_through_height.score < 80) {
                        suggestions.push({text: langManager.currentLang === 'zh' ? 
                            "å®ŒæˆéšæŒ¥åŠ¨ä½œæ—¶ä¿æŒæ‰‹è‡‚é«˜åº¦" : 
                            "Maintain arm height during follow-through"});
                    }
                    
                    if (this.currentMetrics.balance && this.currentMetrics.balance.score < 85) {
                        suggestions.push({text: langManager.currentLang === 'zh' ? 
                            "å‡»çƒåä¿æŒå¹³è¡¡å§¿åŠ¿" : 
                            "Maintain balanced posture after stroke"});
                    }
                }
                
                if (suggestions.length === 0) {
                    suggestions.push({text: this.getText('greatTechnique')});
                }
                
                return suggestions;
            }
            
            getAnalysisDescription(score) {
                if (score >= 90) return this.getText('excellentTechnique');
                if (score >= 80) return this.getText('goodForm');
                if (score >= 70) return this.getText('basicCorrect');
                if (score >= 60) return this.getText('needsAdjustment');
                return this.getText('studyTutorials');
            }
            
            updateAnalysisPanel(score, title, description) {
                document.getElementById('scoreNumber').textContent = score;
                document.getElementById('analysisTitle').textContent = title;
                document.getElementById('analysisDesc').textContent = description;
                
                if (score !== '--') {
                    const degree = (score / 100) * 360;
                    const color = score >= 80 ? '#48bb78' : score >= 60 ? '#ed8936' : '#e53e3e';
                    document.getElementById('scoreCircle').style.background = 
                        `conic-gradient(${color} 0deg ${degree}deg, #e2e8f0 ${degree}deg 360deg)`;
                }
            }
            
            updateMetrics() {
                const metricItems = document.querySelectorAll('.metric-item');
                
                if (!this.selectedTechnique || !this.techniqueConfigs[this.selectedTechnique]) return;
                
                const metrics = this.techniqueConfigs[this.selectedTechnique].metrics;
                
                metricItems.forEach((item, index) => {
                    if (index < metrics.length) {
                        const metric = metrics[index];
                        const metricData = this.currentMetrics[metric.key];
                        const valueElement = item.querySelector('.metric-value');
                        const fillElement = item.querySelector('.metric-fill');
                        
                        if (metricData) {
                            valueElement.textContent = metricData.value;
                            fillElement.style.width = `${Math.max(0, Math.min(100, metricData.score))}%`;
                        } else {
                            valueElement.textContent = '--';
                            fillElement.style.width = '0%';
                        }
                    }
                });
            }
            
            resetMetrics() {
                const metricItems = document.querySelectorAll('.metric-item');
                
                metricItems.forEach(item => {
                    const valueElement = item.querySelector('.metric-value');
                    const fillElement = item.querySelector('.metric-fill');
                    
                    valueElement.textContent = '--';
                    fillElement.style.width = '0%';
                });
            }
            
            updateSuggestions(suggestions) {
                const container = document.getElementById('suggestionsList');
                container.innerHTML = '';
                
                suggestions.forEach((suggestion, index) => {
                    const item = document.createElement('div');
                    item.className = 'suggestion-item';
                    item.style.animationDelay = `${index * 0.1}s`;
                    item.innerHTML = `
                        <div class="suggestion-icon"></div>
                        <span>${suggestion.text}</span>
                    `;
                    container.appendChild(item);
                });
            }
            
            updateStatus(statusKey) {
                const indicator = document.getElementById('statusIndicator');
                indicator.textContent = this.getText(statusKey);
                
                if (statusKey.includes('analyzing')) {
                    indicator.style.background = 'rgba(237, 137, 54, 0.1)';
                    indicator.style.color = '#ed8936';
                } else if (statusKey.includes('ready')) {
                    indicator.style.background = 'rgba(72, 187, 120, 0.1)';
                    indicator.style.color = '#38a169';
                } else {
                    indicator.style.background = 'rgba(113, 128, 150, 0.1)';
                    indicator.style.color = '#718096';
                }
            }
            
            updateButtons(isStart) {
                const startBtn = document.getElementById('startBtn');
                const stopBtn = document.getElementById('stopBtn');
                
                if (isStart) {
                    startBtn.style.display = 'flex';
                    stopBtn.style.display = 'none';
                } else {
                    startBtn.style.display = 'none';
                    stopBtn.style.display = 'flex';
                }
            }
            
            showLoading(show) {
                document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';
            }
            
            showError(message) {
                const errorDiv = document.getElementById('errorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            }
            
            startAnalysisLoop() {
                if (!this.isAnalyzing || this.isUploadMode) return;
                
                setTimeout(() => {
                    if (this.isAnalyzing && !this.isUploadMode) {
                        this.startAnalysisLoop();
                    }
                }, 100);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            new TennisAnalyzer();
        });
    </script>
</body>
</html>